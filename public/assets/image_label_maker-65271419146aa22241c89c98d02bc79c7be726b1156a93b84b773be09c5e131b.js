function SerializeBoundingBoxes(){return JSON.stringify(BoundingBoxes,replacer)}function GetSelectedClass(){return $("input:radio:checked")[0].value}function DeleteSelectedBoxes(){$("li.active").each(DeleteBoundingBox),RedrawBoundingBoxes(BoundingBoxes,"overlay")}function DeleteBoundingBox(o,n){var e=n.getAttribute("uuid");BoundingBoxes=BoundingBoxes.filter(function(o){return o.uuid!=e}),n.outerHTML="",delete n}function insertBoundingBoxListElement(o){var n=document.createElement("li");n.innerHTML=o.classname,n.classList.add("list-group-item"),n.setAttribute("uuid",o.uuid),n.onclick=ToggleBoundingBoxListElement,document.getElementById("bblist").appendChild(n)}function ToggleBoundingBoxListElement(){$(this).toggleClass("active");var o=$(this).attr("uuid"),n=BoundingBoxes.filter(function(n){return n.uuid==o})[0];$(this).hasClass("active")?n.selected=!0:n.selected=!1,RedrawBoundingBoxes(BoundingBoxes,"overlay")}function UpdateBoundingBoxList(){var o=document.getElementById("bblist");if(null!=o){for(;o.hasChildNodes();)o.removeChild(o.lastChild);BoundingBoxes.forEach(insertBoundingBoxListElement);var n=document.getElementById("target"),e=SerializeBoundingBoxes();n.setAttribute("value",e)}}function FindPosition(o){var n=o.getBoundingClientRect();return[n.left,n.top]}function GetCoordinatesDown(o){Dragging=!0;var n,e=0,i=0;if(n=FindPosition(mainimage),console.log(n),!o)var o=window.event;(o.clientX||o.clientY)&&(console.log("e.clientX || e.clientY"),console.log("e.clientX: "+o.clientX.toString()),console.log("e.clientY: "+o.clientY.toString()),e=o.clientX,i=o.clientY,document.body.scrollTop),PosXDown=Math.round(e-n[0]),PosYDown=Math.round(i-n[1]),console.log("PosXDown: "+PosXDown.toString()),console.log("PosYDown: "+PosYDown.toString())}function RenderWhileDragging(o){if(Dragging){console.log("Dragging..");var n,e=0,i=0;if(n=FindPosition(mainimage),console.log(n),!o)var o=window.event;(o.clientX||o.clientY)&&(e=o.clientX,i=o.clientY),PosXNow=Math.round(e-n[0]),PosYNow=Math.round(i-n[1]);var t=Math.abs(PosYNow-PosYDown),s=Math.abs(PosXNow-PosXDown),l=Math.min(PosXNow,PosXDown),d=Math.min(PosYNow,PosYDown),a=GetSelectedClass(),u=$("#mainimage"),g=l/u.width(),r=d/u.height(),c=s/u.width(),B=t/u.height(),w=new BoundingBox(g,r,c,B,a),h=BoundingBoxes.slice();h.push(w),RedrawBoundingBoxes(h,"overlay")}}function GetCoordinatesUp(o){TagCount++,Dragging=!1;var n,e=0,i=0;if(n=FindPosition(mainimage),console.log(n),!o)var o=window.event;(o.clientX||o.clientY)&&(console.log("e.clientX || e.clientY"),console.log("e.clientX: "+o.clientX.toString()),console.log("e.clientY: "+o.clientY.toString()),e=o.clientX,i=o.clientY),PosXUp=Math.round(e-n[0]),PosYUp=Math.round(i-n[1]),console.log("PosXUp: "+PosXUp.toString()),console.log("PosYUp: "+PosYUp.toString());var t=Math.abs(PosYUp-PosYDown),s=Math.abs(PosXUp-PosXDown),l=Math.min(PosXUp,PosXDown),d=Math.min(PosYUp,PosYDown),a=GetSelectedClass(),u=$("#mainimage"),g=l/u.width(),r=d/u.height(),c=s/u.width(),B=t/u.height(),w=new BoundingBox(g,r,c,B,a,TagCount);BoundingBoxes.push(w),UpdateBoundingBoxList(),RedrawBoundingBoxes(BoundingBoxes,"overlay")}function RedrawAllBoundingBoxes(){"undefined"!=typeof BoundingBoxesGroups&&BoundingBoxesGroups.forEach(function(o){RedrawBoundingBoxes(o.BoundingBoxes,o.overlayElementId)})}var BoundingBoxes=[],Dragging=!1,TagCount=0;$(document).on("ready, turbolinks:load",function(){var o=document.getElementById("mainimage");null!=o&&(o.onmousedown=GetCoordinatesDown,o.onmouseup=GetCoordinatesUp,o.onmousemove=RenderWhileDragging);var n=document.getElementById("overlay");null!=n&&(n.onmousedown=GetCoordinatesDown,n.onmouseup=GetCoordinatesUp,n.onmousemove=RenderWhileDragging);var e=$(":radio")[0];null!=e&&(e.checked=!0);null!=n&&(UpdateBoundingBoxList(),RedrawBoundingBoxes(BoundingBoxes,"overlay")),"/image_labels/next"==window.location.pathname&&(window.onkeyup=function(o){68==(o.keyCode?o.keyCode:o.which)&&window.alert("Delete newest box!")})});